const setDefinitions={작물셋:["튼튼한 달걀 주머니","튼튼한 감자 주머니","튼튼한 옥수수 주머니","튼튼한 밀 주머니","튼튼한 보리 주머니"],방직셋:["튼튼한 양털 주머니","튼튼한 거미줄 주머니","튼튼한 가는 실뭉치 주머니","튼튼한 굵은 실뭉치 주머니"],가죽셋:["튼튼한 저가형 가죽 주머니","튼튼한 일반 가죽 주머니","튼튼한 고급 가죽 주머니","튼튼한 최고급 가죽 주머니"],옷감셋:["튼튼한 저가형 옷감 주머니","튼튼한 일반 옷감 주머니","튼튼한 고급 옷감 주머니","튼튼한 최고급 옷감 주머니"],실크셋:["튼튼한 저가형 실크 주머니","튼튼한 일반 실크 주머니","튼튼한 고급 실크 주머니","튼튼한 최고급 실크 주머니","튼튼한 꽃바구니"]};function parseColorInput(e){if(/^#([0-9A-Fa-f]{3}){1,2}$/.test(e))return e;let t=e.match(/^(\d{1,3})[ ,./]+(\d{1,3})[ ,./]+(\d{1,3})$/);if(t){let[a,l,r,n]=t;if(l<=255&&r<=255&&n<=255)return`#${(16777216+(+l<<16)+(+r<<8)+ +n).toString(16).slice(1)}`}return"#FFFFFF"}async function applyColors(){let e=parseColorInput(document.getElementById("colorA").value||"#ffffff"),t=parseColorInput(document.getElementById("colorB").value||"#ffffff"),a=parseColorInput(document.getElementById("colorC_crop_textile").value||"#ffffff"),l=parseColorInput(document.getElementById("colorC_other").value||"#ffffff");displayJumoneyImages(e,t,a,l)}async function displayJumoneyImages(e,t,a,l){let r=document.getElementById("jumoneyContainer");r.innerHTML="";let n=document.createElement("label");for(let[i,o]of(n.className="set-alert",r.appendChild(n),Object.entries(setDefinitions))){let c=document.createElement("div");c.className="set-container";let g=document.createElement("div");g.className="set-container",n.style.display="inline",n.style.margin="0px 0px 10px",n.innerText="하단의 이미지를 드래그 하여 주머니 수배지의 + 칸에 옮기세요",r.appendChild(c),r.appendChild(g);let d="작물셋"===i||"방직셋"===i?a:l;for(let s of o)try{let m=await createJumoneyImage(s,[e,t,d],"close"),u=createImageContainer(s,m,"close");c.appendChild(u);let f=await createJumoneyImage(s,[e,t,d],"open"),y=createImageContainer(s,f,"open");g.appendChild(y)}catch(p){console.error(`이미지 생성 실패 ${s}:`,p)}setDragEvent()}}function createImageContainer(e,t,a){let l=document.createElement("div");return l.className="jumoney-item",l.innerHTML=`
        <h3>${e} (${a})</h3>
        <img src="${t}" data-type="${a}" data-name="${e}" alt="${e} ${a}">
      `,l}async function saveAllImages(){let e=new JSZip,t=parseInt(document.getElementById("scaleSelect").value),a=document.querySelectorAll(".jumoney-item img");for(let l of a){let r=l.getAttribute("data-name"),n=l.getAttribute("data-type"),i=document.createElement("canvas");i.width=l.naturalWidth*t,i.height=l.naturalHeight*t;let o=i.getContext("2d",{alpha:!0});o.imageSmoothingEnabled=!1,o.scale(t,t),o.drawImage(l,0,0);let c=i.toDataURL("image/png");e.file(`${r}_${n}.png`,c.split(",")[1],{base64:!0})}let g=await e.generateAsync({type:"blob"}),d=document.createElement("a");d.href=URL.createObjectURL(g),d.download="all_images.zip",d.click()}async function saveSetImages(){let e=document.getElementById("setSelect").value,t=document.getElementById("typeSelect").value,a=new JSZip,l=parseInt(document.getElementById("scaleSelect").value),r=Array.from(document.querySelectorAll(".jumoney-item img[data-name][data-type]")).filter(a=>setDefinitions[e].includes(a.getAttribute("data-name"))&&("all"===t||a.getAttribute("data-type")===t));for(let n of r){let i=n.getAttribute("data-name"),o=n.getAttribute("data-type"),c=document.createElement("canvas");c.width=n.naturalWidth*l,c.height=n.naturalHeight*l;let g=c.getContext("2d",{alpha:!0});g.imageSmoothingEnabled=!1,g.scale(l,l),g.drawImage(n,0,0);let d=c.toDataURL("image/png");a.file(`${i}_${o}.png`,d.split(",")[1],{base64:!0})}let s=await a.generateAsync({type:"blob"}),m=document.createElement("a");m.href=URL.createObjectURL(s),m.download=`${e}_${t}_images.zip`,m.click()}async function saveAllMergedImages(){let e=parseInt(document.getElementById("scaleSelect").value),t=document.getElementById("bgColorSelect").value,a=parseFloat(document.getElementById("bgOpacity").value),l=document.querySelectorAll(".set-container"),r=Array.from(l).map(t=>Math.max(...Array.from(t.children).map(t=>t.querySelector("img").naturalHeight*e))),n=r.reduce((e,t)=>e+t,0),i=Math.max(...Array.from(l).map(t=>Array.from(t.children).reduce((t,a)=>t+a.querySelector("img").naturalWidth*e,0))),o=document.createElement("canvas");o.width=i,o.height=n;let c=o.getContext("2d",{alpha:!0});c.imageSmoothingEnabled=!1,c.fillStyle=hexToRgba(t,a),c.fillRect(0,0,o.width,o.height);let g=0;for(let d=0;d<l.length;d++){let s=l[d],m=0,u=r[d];for(let f of s.children){let y=f.querySelector("img");c.drawImage(y,m,g,y.naturalWidth*e,y.naturalHeight*e),m+=y.naturalWidth*e}g+=u}let p=document.createElement("a");p.href=o.toDataURL("image/png"),p.download="all_sets_merged.png",p.click()}async function saveMergedSetImages(){let e=document.getElementById("setSelect").value,t=document.getElementById("typeSelect").value,a=parseInt(document.getElementById("scaleSelect").value),l=document.getElementById("bgColorSelect").value,r=parseFloat(document.getElementById("bgOpacity").value),n=Object.keys(setDefinitions[e]).length,i=Array.from(document.querySelectorAll(".jumoney-item img[data-name][data-type]")).filter(a=>setDefinitions[e].includes(a.getAttribute("data-name"))&&("all"===t||a.getAttribute("data-type")===t)),o=Math.ceil(i.length/n),c=Math.max(...i.map(e=>e.naturalWidth*a))*n,g=i[0].naturalHeight*a*o+5,d=document.createElement("canvas");d.width=c,d.height=g;let s=d.getContext("2d",{alpha:!0});s.imageSmoothingEnabled=!1,s.fillStyle=hexToRgba(l,r),s.fillRect(0,0,d.width,d.height);let m=0,u=0;i.forEach((e,t)=>{t>0&&t%n==0&&(u+=e.naturalHeight*a,m=0),s.drawImage(e,m,u,e.naturalWidth*a,e.naturalHeight*a),m+=e.naturalWidth*a});let f=document.createElement("a");f.href=d.toDataURL("image/png"),f.download=`${e}_${t}_merged.png`,f.click()}function hexToRgba(e,t){let a=parseInt(e.slice(1),16);return`rgba(${a>>16&255}, ${a>>8&255}, ${255&a}, ${t})`}function setDragEvent(){document.querySelectorAll(".jumoney-item img").forEach(e=>{e.setAttribute("draggable",!0),e.addEventListener("dragstart",t=>{e.src,e.alt,t.dataTransfer.setData("text/plain",e.src),t.dataTransfer.setData("alt",e.alt)})}),document.querySelectorAll(".small-box, .large-box").forEach(e=>{e.addEventListener("dragover",e=>{e.preventDefault()}),e.addEventListener("drop",t=>{t.preventDefault(),t.dataTransfer.getData("text/plain");let a=t.dataTransfer.getData("text/plain"),l=t.dataTransfer.getData("alt"),r=document.createElement("img");r.src=a,r.alt=l,e.classList.contains("small-box")?r.style.transform="scale(2)":e.classList.contains("large-box")&&(r.style.transform="scale(4)"),r.style.height="auto",e.innerHTML="",e.appendChild(r)})})}async function saveContainerAsSVGImage(){let e=document.getElementById("container");document.fonts.ready.then(()=>{domtoimage.toPng(e,{quality:1,style:{"image-rendering":"pixelated"}}).then(e=>{let t=document.createElement("a");t.href=e,t.download="container-image.png",t.click()}).catch(e=>{console.error("SVG 이미지 생성 오류:",e)})})}async function saveContainerAsSVGImage2(){let e=document.getElementById("container");document.fonts.check("1em MabinogiClassicR"),await document.fonts.ready,domtoimage.toPng(e,{quality:1,style:{"image-rendering":"pixelated"}}).then(e=>{let t=document.createElement("a");t.href=e,t.download="container-image.png",t.click()}).catch(e=>{console.error("SVG 이미지 생성 오류:",e)})}document.addEventListener("DOMContentLoaded",function(){function e(e){let t=e.target.dataset.rgbValid?JSON.parse(e.target.dataset.rgbValid):null;if(t){var l,r,n;let{r:i,g:o,b:c}=t,g=(l=i,r=o,n=c,"#"+(16777216+(l<<16)+(r<<8)+n).toString(16).slice(1).toUpperCase()),d=e.target.closest(".colors").querySelector(".color-rect").getAttribute("data-target");a(d,g,`${i} ${o} ${c}`)}}function t(e){let t=parseInt(e.slice(1),16);return{r:t>>16&255,g:t>>8&255,b:255&t}}function a(e,t,a){let l=document.querySelector(`.color-rect[data-target="${e}"]`),r=document.querySelector(`#color-${e.toLowerCase()}`),n=l.closest(".colors").querySelector(".color-hex");l.style.backgroundColor=t,r.value=a,n.value=t.toUpperCase()}document.querySelectorAll(".color-rect").forEach(e=>{e.addEventListener("click",e=>{let t=e.target.getAttribute("data-target"),a=document.querySelector(`input.color-input[data-target="${t}"]`);a.click()})}),document.querySelectorAll(".color-input").forEach(e=>{e.addEventListener("input",e=>{let l=e.target.value,r=t(l),n=e.target.getAttribute("data-target");a(n,l,`${r.r} ${r.g} ${r.b}`)})}),document.querySelectorAll(".color-rgb").forEach(t=>{t.addEventListener("input",e=>{let t=e.target.value.trim(),a=t.match(/^(\d{1,3})[\/.,\s]+(\d{1,3})[\/.,\s]+(\d{1,3})$/);if(a){let l=parseInt(a[1]),r=parseInt(a[2]),n=parseInt(a[3]);l<=255&&r<=255&&n<=255?e.target.dataset.rgbValid=JSON.stringify({r:l,g:r,b:n}):delete e.target.dataset.rgbValid}else delete e.target.dataset.rgbValid}),t.addEventListener("blur",e),t.addEventListener("keypress",t=>{"Enter"===t.key&&e(t)})}),document.querySelectorAll(".color-hex").forEach(e=>{e.addEventListener("input",e=>{let l=e.target.value;if(/^#[0-9A-Fa-f]{6}$/.test(l)){let r=t(l),n=e.target.closest(".colors").querySelector(".color-rect").getAttribute("data-target");a(n,l,`${r.r} ${r.g} ${r.b}`)}})});let l=document.getElementById("setBorderColor"),r=document.querySelector(".container");l.addEventListener("input",e=>{let t=e.target.value;r.style.borderColor=t})});
      
      
      /////////////
      const BASE_URL="https://shuujumoney.github.io/jumoney/image/jumoney",jumoney={open:{"튼튼한 달걀 주머니":{A:"open_crops_base.png",B:"",C:"",M1:"open_egg.png",M2:"open_plus_top.png"},"튼튼한 감자 주머니":{A:"open_crops_base.png",B:"",C:"",M1:"open_potato.png",M2:"open_plus_top.png"},"튼튼한 옥수수 주머니":{A:"open_crops_base.png",B:"",C:"",M1:"open_corn.png",M2:"open_plus_top.png"},"튼튼한 밀 주머니":{A:"open_crops_base.png",B:"",C:"",M1:"open_wheat.png",M2:"open_plus_top.png"},"튼튼한 보리 주머니":{A:"open_crops_base.png",B:"",C:"",M1:"open_barley.png",M2:"open_plus_top.png"},"튼튼한 양털 주머니":{A:"open_fleece_base.png",B:"open_fleece_main.png",C:"",M1:"open_fleece_plus.png"},"튼튼한 거미줄 주머니":{A:"open_cobweb_base.png",B:"open_cobweb_icon.png",C:"open_cobweb_main.png",M1:"open_plus_top.png"},"튼튼한 가는 실뭉치 주머니":{A:"open_thin_base.png",B:"open_thin_icon.png",C:"open_thin_main.png",M1:"open_plus_top.png"},"튼튼한 굵은 실뭉치 주머니":{A:"open_thick_thread_base.png",B:"open_thick_icon.png",C:"open_thick_main.png",M1:"open_plus_top.png"},"튼튼한 저가형 가죽 주머니":{A:"open_leather_base_1.png",B:"open_leather_main.png",C:"open_leather_number_1.png",M1:"open_plus_bottom.png"},"튼튼한 일반 가죽 주머니":{A:"open_leather_base_2.png",B:"open_leather_main.png",C:"open_leather_number_2.png",M1:"open_plus_top.png"},"튼튼한 고급 가죽 주머니":{A:"open_leather_base_3.png",B:"open_leather_main.png",C:"open_leather_number_3.png",M1:"open_plus_top.png"},"튼튼한 최고급 가죽 주머니":{A:"open_leather_base_4.png",B:"open_leather_main.png",C:"open_leather_number_4.png",M1:"open_plus_top.png"},"튼튼한 저가형 옷감 주머니":{A:"open_fabric_base_all.png",B:"fabric_main.png",C:"open_fabric_number_1.png",M1:"open_plus_bottom.png"},"튼튼한 일반 옷감 주머니":{A:"open_fabric_base_all.png",B:"fabric_main.png",C:"open_fabric_number_2.png",M1:"open_plus_bottom.png"},"튼튼한 고급 옷감 주머니":{A:"open_fabric_base_all.png",B:"fabric_main.png",C:"open_fabric_number_3.png",M1:"open_plus_bottom.png"},"튼튼한 최고급 옷감 주머니":{A:"open_fabric_base_all.png",B:"fabric_main.png",C:"open_fabric_number_4.png",M1:"open_plus_bottom.png"},"튼튼한 저가형 실크 주머니":{A:"open_silk_base_1,2.png",B:"silk_main.png",C:"open_silk_number_1.png",M1:"open_plus_top.png"},"튼튼한 일반 실크 주머니":{A:"open_silk_base_1.png",B:"silk_main.png",C:"open_silk_number_2.png",M1:"open_plus_top.png"},"튼튼한 고급 실크 주머니":{A:"open_silk_base_3,4.png",B:"silk_main.png",C:"open_silk_number_3.png",M1:"open_plus_bottom.png"},"튼튼한 최고급 실크 주머니":{A:"open_silk_base_3,4.png",B:"silk_main.png",C:"open_silk_number_4.png",M1:"open_plus_bottom.png"},"튼튼한 꽃바구니":{A:"open_flower_base.png",B:"open_flower_color2.png",C:"open_flower_main.png",M1:"open_plus_top.png",M2:"open_flower_leaf.png"}},close:{"튼튼한 달걀 주머니":{A:"crops_egg.png",B:"crops_string_egg,potato.png",C:"",M1:"crops_egg_icon.png",M2:"crops_textile_plus.png"},"튼튼한 감자 주머니":{A:"crops_potato.png",B:"crops_string_egg,potato.png",C:"",M1:"crops_potato_icon.png",M2:"crops_textile_plus.png"},"튼튼한 옥수수 주머니":{A:"crops_corn.png",B:"crops_string_corn.png",C:"",M1:"crops_string_corn_icon.png",M2:"crops_textile_plus.png"},"튼튼한 밀 주머니":{A:"crops_wheat.png",B:"crops_string_wheat.png",C:"",M1:"crops_wheat_icon.png",M2:"crops_textile_plus.png"},"튼튼한 보리 주머니":{A:"crops_barley.png",B:"crops_string_barley.png",C:"",M1:"crops_barley_icon.png",M2:"crops_textile_plus.png"},"튼튼한 양털 주머니":{A:"fleece_base.png",B:"",C:"",M1:"fleece_plus.png"},"튼튼한 거미줄 주머니":{A:"cobweb_base.png",B:"cobweb_icon.png",C:"",M1:"crops_textile_plus.png"},"튼튼한 가는 실뭉치 주머니":{A:"thin_thread_base.png",B:"thin_thread_icon.png",C:"",M1:"crops_textile_plus.png"},"튼튼한 굵은 실뭉치 주머니":{A:"thick_thread_base.png",B:"thick_thread_icon.png",C:"",M1:"crops_textile_plus.png"},"튼튼한 저가형 가죽 주머니":{A:"leather_base.png",B:"leather_number_1.png",C:"",M1:"plus_all.png"},"튼튼한 일반 가죽 주머니":{A:"leather_base.png",B:"leather_number_2.png",C:"",M1:"plus_all.png"},"튼튼한 고급 가죽 주머니":{A:"leather_base.png",B:"leather_number_3.png",C:"",M1:"plus_all.png"},"튼튼한 최고급 가죽 주머니":{A:"leather_base.png",B:"leather_number_4.png",C:"",M1:"plus_all.png"},"튼튼한 저가형 옷감 주머니":{A:"fabric_base.png",B:"fabric_number_1.png",C:"",M1:"plus_all.png"},"튼튼한 일반 옷감 주머니":{A:"fabric_base.png",B:"fabric_number_2.png",C:"",M1:"plus_all.png"},"튼튼한 고급 옷감 주머니":{A:"fabric_base.png",B:"fabric_number_3.png",C:"",M1:"plus_all.png"},"튼튼한 최고급 옷감 주머니":{A:"fabric_base.png",B:"fabric_number_4.png",C:"",M1:"plus_all.png"},"튼튼한 저가형 실크 주머니":{A:"silk_base.png",B:"silk_number_1.png",C:"",M1:"plus_all.png",M2:"silk_point.png"},"튼튼한 일반 실크 주머니":{A:"silk_base.png",B:"silk_number_2.png",C:"",M1:"plus_all.png",M2:"silk_point.png"},"튼튼한 고급 실크 주머니":{A:"silk_base.png",B:"silk_number_3.png",C:"",M1:"plus_all.png",M2:"silk_point.png"},"튼튼한 최고급 실크 주머니":{A:"silk_base.png",B:"silk_number_4.png",C:"",M1:"plus_all.png",M2:"silk_point.png"},"튼튼한 꽃바구니":{A:"flower_base.png",B:"flower_fabric.png",C:"",M1:"plus_all.png"}}};let imgType="close";async function createJumoneyImage(n,p,e,o){let a=`${n}-${p.join("-")}-${e}-${o}`;if(defaultImageCache.has(a))return defaultImageCache.get(a);let l="close"===e?"close":"open";imgType=l;let g=jumoney[l][n];if(!g)throw Error("아이템을 찾을 수 없습니다!");let[t,s,r]=p.map(parseColor),[i,c,b,u,m]=await Promise.all([loadImage(g.A,e),loadImage(g.B,e),loadImage(g.C,e),loadImage(g.M1,e),loadImage(g.M2,e)]),h=Math.max(i?.width||0,c?.width||0,b?.width||0),_=Math.max(i?.height||0,c?.height||0,b?.height||0),M=document.createElement("canvas"),C=M.getContext("2d",{alpha:!0,willReadFrequently:!0});M.width=h,M.height=_,C.clearRect(0,0,M.width,M.height);let f=i?await applyNewColor(i,t,M,C):null,B=c?await applyNewColor(c,s,M,C):null,w=b?await applyNewColor(b,r,M,C,!0,n):null;return f&&C.drawImage(f,0,0),B&&C.drawImage(B,0,0),w&&C.drawImage(w,0,0),u&&C.drawImage(u,0,0),m&&C.drawImage(m,0,0),o&&setBackgroundColor(C,o,M),window.defaultImageCache.set(a,M.toDataURL("image/png")),M.toDataURL("image/png")}function loadImage(n,p){let e=`${p}/${n}`;return defaultImageCache.has(n)?Promise.resolve(defaultImageCache.get(e)):new Promise((e,o)=>{if(!n)return e(null);let a=new Image;a.crossOrigin="anonymous",a.src=`https://shuujumoney.github.io/jumoney/image/jumoney/${p}/${n}`,a.onload=()=>{e(a)},a.onerror=()=>o(Error(`이미지 로드 실패: ${n}`))})}async function applyNewColor(n,p,e,o,a=!1,l=""){o.drawImage(n,0,0),e.width=n.width,e.height=n.height,o.clearRect(0,0,e.width,e.height),o.drawImage(n,0,0);let g=o.getImageData(0,0,e.width,e.height),t=g.data;for(let s=0;s<t.length;s+=4){let r=t[s]-128,i=t[s+1]-128,c=t[s+2]-128,b=clamp(p.r+r),u=clamp(p.g+i),m=clamp(p.b+c);a&&255===t[s]&&255===t[s+1]&&255===t[s+2]&&(l.includes("가죽")&&/(고급|최고급)/.test(l)?(b=clamp(b+30),u=clamp(u+30),m=clamp(m+30)):(l.includes("옷감")||l.includes("실크"))&&/(일반|고급|최고급)/.test(l)&&(b=clamp(b+30),u=clamp(u+30),m=clamp(m+30))),t[s]=b,t[s+1]=u,t[s+2]=m}return o.putImageData(g,0,0),new Promise(n=>{let p=new Image;p.src=e.toDataURL("image/png"),p.onload=()=>n(p)})}function parseColor(n){if(n.startsWith("#")){let p=parseInt(n.slice(1),16);return{r:p>>16&255,g:p>>8&255,b:255&p}}if(n.startsWith("rgb")){let[e,o,a]=n.match(/\d+/g).map(Number);return{r:e,g:o,b:a}}{let[l,g,t]=n.split(" ").map(Number);return{r:l,g,b:t}}}function clamp(n){return Math.max(0,Math.min(255,n))}function setBackgroundColor(n,p,e){n.globalCompositeOperation="destination-over",p&&(n.fillStyle=p,n.fillRect(0,0,e.width,e.height))}