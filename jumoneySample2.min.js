const BASE_URL="https://shuujumoney.github.io/jumoney/image/jumoney",jumoney={open:{"튼튼한 달걀 주머니":{A:"open_crops_base.png",B:"",C:"",M1:"open_egg.png",M2:"open_plus_top.png"},"튼튼한 감자 주머니":{A:"open_crops_base.png",B:"",C:"",M1:"open_potato.png",M2:"open_plus_top.png"},"튼튼한 옥수수 주머니":{A:"open_crops_base.png",B:"",C:"",M1:"open_corn.png",M2:"open_plus_top.png"},"튼튼한 밀 주머니":{A:"open_crops_base.png",B:"",C:"",M1:"open_wheat.png",M2:"open_plus_top.png"},"튼튼한 보리 주머니":{A:"open_crops_base.png",B:"",C:"",M1:"open_barley.png",M2:"open_plus_top.png"},"튼튼한 양털 주머니":{A:"open_fleece_base.png",B:"open_fleece_main.png",C:"",M1:"open_fleece_plus.png"},"튼튼한 거미줄 주머니":{A:"open_cobweb_base.png",B:"open_cobweb_icon.png",C:"open_cobweb_main.png",M1:"open_plus_top.png"},"튼튼한 가는 실뭉치 주머니":{A:"open_thin_base.png",B:"open_thin_icon.png",C:"open_thin_main.png",M1:"open_plus_top.png"},"튼튼한 굵은 실뭉치 주머니":{A:"open_thick_thread_base.png",B:"open_thick_icon.png",C:"open_thick_main.png",M1:"open_plus_top.png"},"튼튼한 저가형 가죽 주머니":{A:"open_leather_base_1.png",B:"open_leather_main.png",C:"open_leather_number_1.png",M1:"open_plus_bottom.png"},"튼튼한 일반 가죽 주머니":{A:"open_leather_base_2.png",B:"open_leather_main.png",C:"open_leather_number_2.png",M1:"open_plus_top.png"},"튼튼한 고급 가죽 주머니":{A:"open_leather_base_3.png",B:"open_leather_main.png",C:"open_leather_number_3.png",M1:"open_plus_top.png"},"튼튼한 최고급 가죽 주머니":{A:"open_leather_base_4.png",B:"open_leather_main.png",C:"open_leather_number_4.png",M1:"open_plus_top.png"},"튼튼한 저가형 옷감 주머니":{A:"open_fabric_base_all.png",B:"fabric_main.png",C:"open_fabric_number_1.png",M1:"open_plus_bottom.png"},"튼튼한 일반 옷감 주머니":{A:"open_fabric_base_all.png",B:"fabric_main.png",C:"open_fabric_number_2.png",M1:"open_plus_bottom.png"},"튼튼한 고급 옷감 주머니":{A:"open_fabric_base_all.png",B:"fabric_main.png",C:"open_fabric_number_3.png",M1:"open_plus_bottom.png"},"튼튼한 최고급 옷감 주머니":{A:"open_fabric_base_all.png",B:"fabric_main.png",C:"open_fabric_number_4.png",M1:"open_plus_bottom.png"},"튼튼한 저가형 실크 주머니":{A:"open_silk_base_1,2.png",B:"silk_main.png",C:"open_silk_number_1.png",M1:"open_plus_top.png"},"튼튼한 일반 실크 주머니":{A:"open_silk_base_1.png",B:"silk_main.png",C:"open_silk_number_2.png",M1:"open_plus_top.png"},"튼튼한 고급 실크 주머니":{A:"open_silk_base_3,4.png",B:"silk_main.png",C:"open_silk_number_3.png",M1:"open_plus_bottom.png"},"튼튼한 최고급 실크 주머니":{A:"open_silk_base_3,4.png",B:"silk_main.png",C:"open_silk_number_4.png",M1:"open_plus_bottom.png"},"튼튼한 꽃바구니":{A:"open_flower_base.png",B:"open_flower_color2.png",C:"open_flower_main.png",M1:"open_plus_top.png",M2:"open_flower_leaf.png"}},close:{"튼튼한 달걀 주머니":{A:"crops_egg.png",B:"crops_string_egg,potato.png",C:"",M1:"crops_egg_icon.png",M2:"crops_textile_plus.png"},"튼튼한 감자 주머니":{A:"crops_potato.png",B:"crops_string_egg,potato.png",C:"",M1:"crops_potato_icon.png",M2:"crops_textile_plus.png"},"튼튼한 옥수수 주머니":{A:"crops_corn.png",B:"crops_string_corn.png",C:"",M1:"crops_string_corn_icon.png",M2:"crops_textile_plus.png"},"튼튼한 밀 주머니":{A:"crops_wheat.png",B:"crops_string_wheat.png",C:"",M1:"crops_wheat_icon.png",M2:"crops_textile_plus.png"},"튼튼한 보리 주머니":{A:"crops_barley.png",B:"crops_string_barley.png",C:"",M1:"crops_barley_icon.png",M2:"crops_textile_plus.png"},"튼튼한 양털 주머니":{A:"fleece_base.png",B:"",C:"",M1:"fleece_plus.png"},"튼튼한 거미줄 주머니":{A:"cobweb_base.png",B:"cobweb_icon.png",C:"",M1:"crops_textile_plus.png"},"튼튼한 가는 실뭉치 주머니":{A:"thin_thread_base.png",B:"thin_thread_icon.png",C:"",M1:"crops_textile_plus.png"},"튼튼한 굵은 실뭉치 주머니":{A:"thick_thread_base.png",B:"thick_thread_icon.png",C:"",M1:"crops_textile_plus.png"},"튼튼한 저가형 가죽 주머니":{A:"leather_base.png",B:"leather_number_1.png",C:"",M1:"plus_all.png"},"튼튼한 일반 가죽 주머니":{A:"leather_base.png",B:"leather_number_2.png",C:"",M1:"plus_all.png"},"튼튼한 고급 가죽 주머니":{A:"leather_base.png",B:"leather_number_3.png",C:"",M1:"plus_all.png"},"튼튼한 최고급 가죽 주머니":{A:"leather_base.png",B:"leather_number_4.png",C:"",M1:"plus_all.png"},"튼튼한 저가형 옷감 주머니":{A:"fabric_base.png",B:"fabric_number_1.png",C:"",M1:"plus_all.png"},"튼튼한 일반 옷감 주머니":{A:"fabric_base.png",B:"fabric_number_2.png",C:"",M1:"plus_all.png"},"튼튼한 고급 옷감 주머니":{A:"fabric_base.png",B:"fabric_number_3.png",C:"",M1:"plus_all.png"},"튼튼한 최고급 옷감 주머니":{A:"fabric_base.png",B:"fabric_number_4.png",C:"",M1:"plus_all.png"},"튼튼한 저가형 실크 주머니":{A:"silk_base.png",B:"silk_number_1.png",C:"",M1:"plus_all.png",M2:"silk_point.png"},"튼튼한 일반 실크 주머니":{A:"silk_base.png",B:"silk_number_2.png",C:"",M1:"plus_all.png",M2:"silk_point.png"},"튼튼한 고급 실크 주머니":{A:"silk_base.png",B:"silk_number_3.png",C:"",M1:"plus_all.png",M2:"silk_point.png"},"튼튼한 최고급 실크 주머니":{A:"silk_base.png",B:"silk_number_4.png",C:"",M1:"plus_all.png",M2:"silk_point.png"},"튼튼한 꽃바구니":{A:"flower_base.png",B:"flower_fabric.png",C:"",M1:"plus_all.png"}}};let imgType="close";async function createJumoneyImage(n,p,e,o){let a=`${n}-${p.join("-")}-${e}-${o}`;if(defaultImageCache.has(a))return defaultImageCache.get(a);let l="close"===e?"close":"open";imgType=l;let g=jumoney[l][n];if(!g)throw Error("아이템을 찾을 수 없습니다!");let[t,s,r]=p.map(parseColor),[i,c,b,u,m]=await Promise.all([loadImage(g.A,e),loadImage(g.B,e),loadImage(g.C,e),loadImage(g.M1,e),loadImage(g.M2,e)]),h=Math.max(i?.width||0,c?.width||0,b?.width||0),_=Math.max(i?.height||0,c?.height||0,b?.height||0),M=document.createElement("canvas"),C=M.getContext("2d",{alpha:!0,willReadFrequently:!0});M.width=h,M.height=_,C.clearRect(0,0,M.width,M.height);let f=i?await applyNewColor(i,t,M,C):null,B=c?await applyNewColor(c,s,M,C):null,w=b?await applyNewColor(b,r,M,C,!0,n):null;return f&&C.drawImage(f,0,0),B&&C.drawImage(B,0,0),w&&C.drawImage(w,0,0),u&&C.drawImage(u,0,0),m&&C.drawImage(m,0,0),o&&setBackgroundColor(C,o,M),window.defaultImageCache.set(a,M.toDataURL("image/png")),M.toDataURL("image/png")}function loadImage(n,p){let e=`${p}/${n}`;return defaultImageCache.has(n)?Promise.resolve(defaultImageCache.get(e)):new Promise((e,o)=>{if(!n)return e(null);let a=new Image;a.crossOrigin="anonymous",a.src=`https://shuujumoney.github.io/jumoney/image/jumoney/${p}/${n}`,a.onload=()=>{e(a)},a.onerror=()=>o(Error(`이미지 로드 실패: ${n}`))})}async function applyNewColor(n,p,e,o,a=!1,l=""){o.drawImage(n,0,0),e.width=n.width,e.height=n.height,o.clearRect(0,0,e.width,e.height),o.drawImage(n,0,0);let g=o.getImageData(0,0,e.width,e.height),t=g.data;for(let s=0;s<t.length;s+=4){let r=t[s]-128,i=t[s+1]-128,c=t[s+2]-128,b=clamp(p.r+r),u=clamp(p.g+i),m=clamp(p.b+c);a&&255===t[s]&&255===t[s+1]&&255===t[s+2]&&(l.includes("가죽")&&/(고급|최고급)/.test(l)?(b=clamp(b+30),u=clamp(u+30),m=clamp(m+30)):(l.includes("옷감")||l.includes("실크"))&&/(일반|고급|최고급)/.test(l)&&(b=clamp(b+30),u=clamp(u+30),m=clamp(m+30))),t[s]=b,t[s+1]=u,t[s+2]=m}return o.putImageData(g,0,0),new Promise(n=>{let p=new Image;p.src=e.toDataURL("image/png"),p.onload=()=>n(p)})}function parseColor(n){if(n.startsWith("#")){let p=parseInt(n.slice(1),16);return{r:p>>16&255,g:p>>8&255,b:255&p}}if(n.startsWith("rgb")){let[e,o,a]=n.match(/\d+/g).map(Number);return{r:e,g:o,b:a}}{let[l,g,t]=n.split(" ").map(Number);return{r:l,g,b:t}}}function clamp(n){return Math.max(0,Math.min(255,n))}function setBackgroundColor(n,p,e){n.globalCompositeOperation="destination-over",p&&(n.fillStyle=p,n.fillRect(0,0,e.width,e.height))}